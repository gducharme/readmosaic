# AUTO-GENERATED by seedpipe.tools.compile
# DO NOT EDIT. Changes will be overwritten.
# Source: pipeline.yaml hash: sha256:94ffa461f978c5eb616be7b6f51bfbead2d33a3f1169ce47e44c9cdbc415d1e2
# Contracts hash: sha256:da7fb7e4e9d3ad66fdc6a9db71bdc78268e8206ab9df353348b332de77570731

from __future__ import annotations

from dataclasses import dataclass
import json
from pathlib import Path
from typing import Any

@dataclass
class ProducedBy:
    run_id: str
    stage_id: str
    attempt: int = 1

@dataclass
class ArtifactRef:
    name: str
    path: str
    hash: str
    schema_version: str
    produced_by: ProducedBy
    bytes: int | None = None

@dataclass
class ItemResult:
    item_id: str
    ok: bool
    error: dict[str, Any] | None = None

CONTRACTS: dict[str, dict[str, Any]] = json.loads('{\n  "artifact_ref.schema.json": {\n    "$id": "seedpipe://spec/phase1/contracts/artifact_ref.schema.json",\n    "$schema": "https://json-schema.org/draft/2020-12/schema",\n    "additionalProperties": false,\n    "properties": {\n      "hash": {\n        "pattern": "^[a-z0-9]+:[0-9a-f]{8,}$",\n        "type": "string"\n      },\n      "name": {\n        "minLength": 1,\n        "type": "string"\n      },\n      "path": {\n        "minLength": 1,\n        "type": "string"\n      },\n      "produced_by": {\n        "additionalProperties": false,\n        "properties": {\n          "attempt": {\n            "minimum": 1,\n            "type": "integer"\n          },\n          "run_id": {\n            "minLength": 1,\n            "type": "string"\n          },\n          "stage_id": {\n            "minLength": 1,\n            "type": "string"\n          }\n        },\n        "required": [\n          "run_id",\n          "stage_id"\n        ],\n        "type": "object"\n      },\n      "schema_version": {\n        "minLength": 1,\n        "type": "string"\n      }\n    },\n    "required": [\n      "name",\n      "path",\n      "hash",\n      "schema_version",\n      "produced_by"\n    ],\n    "title": "ArtifactRef",\n    "type": "object"\n  },\n  "item_state_row.schema.json": {\n    "$id": "seedpipe://spec/phase1/contracts/item_state_row.schema.json",\n    "$schema": "https://json-schema.org/draft/2020-12/schema",\n    "additionalProperties": false,\n    "properties": {\n      "item_id": {\n        "minLength": 1,\n        "type": "string"\n      },\n      "run_id": {\n        "minLength": 1,\n        "type": "string"\n      },\n      "state": {\n        "enum": [\n          "pending",\n          "in_progress",\n          "succeeded",\n          "failed",\n          "skipped",\n          "quarantined"\n        ],\n        "type": "string"\n      },\n      "updated_at": {\n        "format": "date-time",\n        "type": "string"\n      }\n    },\n    "required": [\n      "run_id",\n      "item_id",\n      "state",\n      "updated_at"\n    ],\n    "title": "ItemStateRow",\n    "type": "object"\n  },\n  "items_row.schema.json": {\n    "$id": "seedpipe://spec/phase1/contracts/items_row.schema.json",\n    "$schema": "https://json-schema.org/draft/2020-12/schema",\n    "additionalProperties": true,\n    "properties": {\n      "item_id": {\n        "minLength": 1,\n        "type": "string"\n      }\n    },\n    "required": [\n      "item_id"\n    ],\n    "title": "ItemsRow",\n    "type": "object"\n  },\n  "manifest.schema.json": {\n    "$id": "seedpipe://spec/phase1/contracts/manifest.schema.json",\n    "$schema": "https://json-schema.org/draft/2020-12/schema",\n    "additionalProperties": false,\n    "properties": {\n      "code_version": {\n        "minLength": 1,\n        "type": "string"\n      },\n      "config_hash": {\n        "pattern": "^[a-z0-9]+:[0-9a-f]{8,}$",\n        "type": "string"\n      },\n      "created_at": {\n        "format": "date-time",\n        "type": "string"\n      },\n      "inputs": {\n        "items": {\n          "$ref": "seedpipe://spec/phase1/contracts/artifact_ref.schema.json"\n        },\n        "type": "array"\n      },\n      "manifest_version": {\n        "const": "phase1-v0",\n        "type": "string"\n      },\n      "pipeline_id": {\n        "minLength": 1,\n        "type": "string"\n      },\n      "run_id": {\n        "minLength": 1,\n        "type": "string"\n      },\n      "stage_outputs": {\n        "items": {\n          "additionalProperties": false,\n          "properties": {\n            "outputs": {\n              "items": {\n                "$ref": "seedpipe://spec/phase1/contracts/artifact_ref.schema.json"\n              },\n              "type": "array"\n            },\n            "stage_id": {\n              "minLength": 1,\n              "type": "string"\n            }\n          },\n          "required": [\n            "stage_id",\n            "outputs"\n          ],\n          "type": "object"\n        },\n        "type": "array"\n      }\n    },\n    "required": [\n      "manifest_version",\n      "run_id",\n      "pipeline_id",\n      "code_version",\n      "config_hash",\n      "inputs",\n      "stage_outputs",\n      "created_at"\n    ],\n    "title": "SeedpipeRunManifest",\n    "type": "object"\n  }\n}\n')

def get_schema(name: str) -> dict[str, Any]:
    if name not in CONTRACTS:
        raise KeyError(f'unknown schema: {name}')
    return CONTRACTS[name]

def load_json(path: str | Path) -> Any:
    return json.loads(Path(path).read_text())
