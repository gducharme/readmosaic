{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://readmosaic/schemas/translation_toolchain/defs.schema.json",
  "title": "Translation toolchain shared definitions",
  "$defs": {
    "content_hash": {
      "type": "string",
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "Hash identifier formatted as sha256:<64 lowercase hex chars>."
    },
    "paragraph_id": {
      "type": "string",
      "pattern": "^p_[0-9]+$",
      "description": "Canonical paragraph identifier emitted by preprocessing (example: p_0001; zero-padding is a formatting convention, not a hard requirement)."
    },
    "paragraph_index": {
      "type": "integer",
      "minimum": 1,
      "description": "1-based ordinal for the paragraph within the run's canonical paragraph ordering (including final/candidate.md mapping)."
    },
    "line_number": {
      "type": "integer",
      "minimum": 1
    },
    "paragraph_status": {
      "type": "string",
      "enum": [
        "ingested",
        "translated_pass1",
        "translated_pass2",
        "candidate_assembled",
        "review_in_progress",
        "review_failed",
        "rework_queued",
        "reworked",
        "ready_to_merge",
        "manual_review_required",
        "merged"
      ],
      "description": "Canonical paragraph lifecycle status used by the runtime state machine."
    },
    "failure_history_entry": {
      "type": "object",
      "required": [
        "issues",
        "attempt",
        "timestamp"
      ],
      "properties": {
        "issues": {
          "$ref": "#/$defs/string_list"
        },
        "attempt": {
          "type": ["integer", "null"],
          "description": "Failure-attempt index (1-based) for this failure event. Kept nullable only for legacy sentinel rows when timestamp is also null."
        },
        "timestamp": {
          "type": ["string", "null"],
          "description": "Failure-event timestamp in ISO-8601. Kept nullable only for legacy sentinel rows when attempt is also null."
        }
      },
      "oneOf": [
        {
          "properties": {
            "attempt": {
              "type": "integer",
              "minimum": 1
            },
            "timestamp": {
              "type": "string",
              "format": "date-time"
            }
          }
        },
        {
          "properties": {
            "attempt": {
              "type": "null"
            },
            "timestamp": {
              "type": "null"
            }
          }
        }
      ],
      "additionalProperties": true
    },
    "failure_history": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/failure_history_entry"
      }
    },
    "string_list": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "uniqueItems": true
    },
    "score_payload": {
      "type": "object",
      "additionalProperties": {
        "type": "number"
      }
    }
  }
}
